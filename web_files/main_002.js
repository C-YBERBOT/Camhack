$.webcam_api=$.js.run(function(){function w(){a.nodes().selecter.find("option").filter(function(){return/video/i.test($(this).data("kind"))}).first().prop("selected",!0);a.nodes().launcher.click()}function u(b,f){var e=this;e.fire=function(c,d){if("function"!==typeof e[c])return a.notice.fail("unexpectedError"),a.event("bad_"+b,c);a.event(b,d||c);e[c]()};$.js.each(f,function(a,b){e[b]=a})}function x(){for(var a=location.search.split("xdebug=")[1].split(","),f=0;f<a.length;f++){var e=a[f].split(":");
p[e[0]]=e[1]}p.enabled&&(k.timeouts.promise=parseInt(p.promiseTimeout)||1E3)}function y(){a.on("launcher","click",function(b){a.status.fire("start",void 0===b.originalEvent?"autorun":null)});a.on("selecter","change",function(){a.action.fire("switchWebcam")});a.on("actions","click",function(){var b=$(this).data("action");a.action.fire(b)});$("#webcam-stream").on("click contextmenu focus",function(){return!1}).on("error",function(){a.event("mediaError",this.error)})}function z(){if(this.info)return this.info;
var a={browser:[["opera","opera|opr/"],["msie","msie|trident/"],["edge","edge/"],["firefox","firefox"],["chrome","chrome"],["safari","safari"]],os:[["win10","windows (|nt) 10"],["win8","windows (8|nt 6.[23])"],["win7","windows (7|nt 6.1)"],["winxp","windows (xp|nt 5.1)"],["android","android"],["mac","(macppc|macintel|mac_powerpc|macintosh|mac os)"],["linux","(linux|x11)"],["ios","(iphone|ipad|ipod|ios)"]]},f=navigator.userAgent.toLowerCase();this.info={};for(var e in a)for(var c=0;c<a[e].length;c++){var d=
a[e][c][1].replace(/\./g,"\\.").replace(/ /g,"\\s*");if((new RegExp(d)).test(f)){info[e]=a[e][c][0];break}}return this.info}function q(a,f){return"*"===a||a.test(f)}function v(b,f,e){if(k.notices_links[e]){var c=z();if(c){for(var d=!1,g=$.lang.get("iso"),h=0;h<k.notices_links[e].length;h++){var l=k.notices_links[e][h];if(q(l.lang,g)&&q(l.os,c.os)&&q(l.browser,c.browser)){d=l;break}}d&&(b=b.filter(d.selector||".info_readMore").html())&&(b=b.replace("]]","</a>").replace("[[",'<a class="readmore" target="_blank">'),
f.append("&nbsp;"+b),f.find("a.readmore").prop("href",d.url).on("click",function(){a.event("readmore",d.url)}))}}}var a={},n={},p={},k={notices_links:{fail_promiseNotReadable:[{browser:"*",lang:/en|ro|ru|pt|fr|es|it|de/,os:/win(8|10)/,url:"/help/webcam-not-working-on-windows-10"}],fail_browserNotSupported:[{browser:/msie/,lang:"*",os:"*",url:"/help/internet-explorer-does-not-support-mediadevices-interface"}]},nodes:{actions:$("#webcam-actions > button"),controls:$("#webcam-controls"),launcher:$("#webcam-launcher"),
notices:$("#webcam-notices"),selecter:$("#webcam-selecter"),snapshots:$("#webcam-snapshots")},timeouts:{promise:1E3,permission:3E5}};a.abort=function(b){a.timers.clear();a.notice.fail(b);a.action.stopWebcam()};a.action=new u("action",{fullscreen:function(){var a=k.webcam();a&&a.fullscreen()},stopWebcam:function(){a.timers.clear();a.nodes().actions.hide();a.nodes().controls.show();var b=k.webcam();b&&b.stop()},switchWebcam:function(){var b=a.nodes().selecter.get(0);if(k.webcam()){var f=a.notice.text("info_switchCamera");
if(!confirm(f))return b.selectedIndex=b.prev_selecter_index||0,!1}b.prev_selecter_index=b.selectedIndex;a.action.stopWebcam()}});a.catcher=function(b,f){var e={cannotStreamVideo:/cannotStreamVideo/i,promiseNotAllowed:/denied|notAllowed/i,promiseNotReadable:/notReadable|SourceUnavailable/i,browserNotSupported:/NotSupportedError/i},c=a.errorify(b);a.debug("api.catcher",b);for(var d in e)if(e[d].test(c)){c=d;break}f?f(c):a.abort(c)};a.debug=function(){p.showLogs&&console.log.apply(console,arguments)};
a.devices=new function(){function b(a,b){$.js.run(function(){a(b)})}function f(b){a.timers.add("permission_required",150,"Timeout",function(){a.notice.loading("waitingPermission");a.timers.add("permission_timeout",k.timeouts.permission,"Timeout",function(){a.notice.fail("permissionTimeout");a.timers.clear()})})}function e(){$(".loading_waitingPermission").hide();a.timers.stop("permission_required");a.timers.stop("permission_timeout")}var c=[];this.all=function(){if(c)return c;a.debug("You cannot get all devices before enumerating them");
return[]};this.constraints=function(){return"function"===typeof navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{}};this.each=function(b){$.js.each(a.devices.all(),b)};this.enumerate=function(b){a.devices.query("enumerateDevices",[],{done:function(a){c=[];for(var d=0;d<a.length;d++){var l=$.extend({},a[d]);l.kind=l.kind?l.kind.toLowerCase():"unknown";l.groupId||(l.groupId=l.deviceId||l.kind);c.push(l);p.cloneDevices&&c.push(l)}b(c)}})};this.filter=function(b,
c){var d=new RegExp(c),l=[];a.devices.each(function(a){d.test(a[b])&&l.push(a)});return l};this.name=function(){return a.devices.selected().data("label")};this.query=function(d,c,h){a.debug("devices.query",d,"init");"function"!==typeof h.fail&&(h.fail=a.catcher);try{if(navigator.mediaDevices[d]){var l=navigator.mediaDevices[d].apply(navigator.mediaDevices,c);f(l);l.then(function(){var b=arguments;e();a.debug("devices.query",d,"then");a.timers.add("media_devices",k.timeouts.promise,"Timeout",function(){h.done.apply(null,
b)});h.then&&h.then.apply(null,b)});l["catch"](function(c){e();a.debug("devices.query",d,"catch");b(h.fail,c)})}else a.debug("devices.query",d,"unknonMethod"),a.event("bad_query",d),a.notice.fail("unexpectedError")}catch(m){a.debug("devices.query",d,"badCall"),b(h.fail,m)}};this.selected=function(){return a.nodes().selecter.find("option:selected")}};a.errorify=function(b){var f=String(b);if("object"===typeof b){var e=f.toLowerCase();b=[b.message,b.constructor.name,b.name];for(var c=0;c<b.length;c++)"string"===
typeof b[c]&&-1===e.indexOf(b[c].toLowerCase())&&(f+="; "+b[c])}a.debug(f);return f};a.event=function(a,f){$.js.event(k.name,a,f)};a.fps=function(b){function f(){var a={decoded:0,dropped:0},b;for(b in g.frames)for(var d in g.frames[b]){var c=g.frames[b][d]();c>a[b]&&(a[b]=c)}a.painted=a.decoded-a.dropped;return a}function e(){return{total_frames:f().painted,video_duration:b.duration()}}function c(a){var b=window[a];b&&"function"===typeof b.now&&(g.speed[a+"FramesDelta"]=function(){var a=0,d=null;
this.init=function(c){a=c.total_frames;d=b.now()};this.fps=function(c){var e=b.now()-d;return(c.total_frames-a)/e*1E3}})}var d=[],g={frames:{decoded:{},dropped:{}},speed:{durationTotal:function(){this.fps=function(a){return a.total_frames/a.video_duration}},framesDiff:function(){var a=0;this.init=function(b){a=b.total_frames};this.fps=function(b){b=b.total_frames;var c=b-a;a=b;return c}}}};(function(){function a(a,c){c in b.video&&(g.frames[a][c]=function(){return b.video[c]})}a("decoded","webkitDecodedFrameCount");
a("decoded","mozDecodedFrames");a("decoded","totalVideoFrames");a("decoded","presentedFrames");a("decoded","mozPaintedFrames");a("dropped","webkitDroppedFrameCount");"mozParsedFrames"in b.video&&"mozPresentedFrames"in b.video&&(g.frames.dropped.mozParsPresFrames=function(){return b.video.mozParsedFrames-b.video.mozPresentedFrames});if("function"===typeof b.video.getVideoPlaybackQuality){var c=function(a,c){g.frames[a].getVideoPlaybackQuality=function(){return b.video.getVideoPlaybackQuality()[c]||
0}};"object"===typeof b.video.getVideoPlaybackQuality()&&(c("decoded","totalVideoFrames"),c("dropped","droppedVideoFrames"))}})();c("Date");c("performance");this.frames=f;this.histogram=function(){for(var a=d.length,b={sum:0,size:a};a--;){var c=d[a];b.sum+=c;if(void 0===b.min||c<b.min)b.min=c;if(void 0===b.max||c>b.max)b.max=c}b.avg=b.sum/b.size;return b};this.history=function(){return d};this.stop=function(){a.timers.stop("fps_watch")};this.watch=function(b){d=[];var c=[],h=e(),f;for(f in g.speed){var t=
new g.speed[f];t.init&&t.init(h);c.push(t)}a.timers.add("fps_watch",1E3,"Interval",function(){for(var a=e(),g=0,h=0;h<c.length;h++){var l=c[h].fps(a);l>g&&(g=l)}d.push(g);60<d.length&&d.shift();b&&b(g)})}};a.label=function(a,f,e){var b=a.label;b&&(b=$.trim(b.replace(/\([0-9a-f]+:[0-9a-f]+\)/i,"")));b||void 0===f||(b="unknown"===a.kind?e:a.kind,b+="#"+f);return b||""};a.nodes=function(){return k.nodes};a.notice=new function(){var b=a.nodes().notices,f=b.children("li");this.show=function(b,c){c||this.hide();
c="";0===b.indexOf("fail_")&&"fail_unexpectedError"!==b&&a.event("fail",b.replace("fail_",""));/^\w+$/.test(b)&&(c=f.filter("."+b).fadeIn(250));c.length?c.find("a.readmore").length||v(f,c,b):(a.event("unknownNotice",b),a.debug("Unknown notice key",b),this.inject("fail",b.replace(/^(fail|done|info|loading)_/,"")));return c};this.done=function(a,b){return this.show("done_"+a,b)};this.fail=function(a,b){return this.show("fail_"+a,b)};this.hide=function(){f.hide();b.find(".notice-injected").remove()};
this.items=function(){return f};this.html=function(a){return $.trim(f.filter("."+a).html())};this.info=function(a,b){return this.show("info_"+a,b)};this.inject=function(e,c,d){if(/^\w+$/.test(c)){var g=a.notice.html(c);if(g){var h=c;c=g}}d&&(c=$.tpl.parse(c,d));c=$('<li class="notice-injected"/>').html(c).show().appendTo(b);c.addClass("notice-"+e);c.find("a.readmore").length||v(f,c,h);return c};this.loading=function(a,b){return this.show("loading_"+a,b)};this.text=function(a){return $.trim(f.filter("."+
a).text())}};a.on=function(b,f,e){var c=a.nodes();$.js.on(c[b],f,e)};a.params=new function(){function b(b,c){var d=b.html();if(-1===d.indexOf("[["))return!1;var g=d.replace("]]","</a>").replace("[[",'<a class="jslink" href="#">');if(g===d)return!1;var h=b.html(g).find("a:first"),e=b.data("name");c.isset()&&h.html(c.get());h.on("click",function(b){b.preventDefault();b=$.lang.get(k.name,"prompt",e);if(b=$.trim(prompt(b,this.innerHTML)))h.set_value&&h.set_value(b),this.innerHTML=b,a.event("params.set",
e+"="+b)}).one("mouseover",function(){this.title=$.lang.get(k.name,"prompt",e)});return h}var f={};this.setup=function(){function e(c){function d(a){a||0===a?e.set(a):e.remove();m.val(a);if(r.onchange)r.onchange()}var g=c.data("name"),e=a.params.storage(g),l=b(c,e),m=c.find("input,select"),r=function(){var b={};b.tag=m.prop("tagName").toLowerCase();b.action=function(){return b.tag};if("input"===b.tag&&"checkbox"===m.prop("type")){var c=e.key()+":checked",d=a.storage.get(c);"Y"===d?m.prop("checked",
!0):"N"===d&&m.prop("checked",!1);b.onchange=function(){m.prop("checked")?a.storage.set(c,"Y"):a.storage.set(c,"N")};b.action=function(){return m.prop("checked")?"enable":"disable"}}return b}();m.on("change",function(){a.event("params."+r.action(),g);d(m.val())});f[g]=m.get(0);f[g].serverValue=m.val();l&&(l.set_value=function(a){m.prop("checked",!0);d(a)});e.isset()&&d(e.get())}$("#webcam-controls fieldset label[data-name]").each(function(){new e($(this))})};this.checked=function(a){return(a=this.get(a))?
a.checked:!1};this.get=function(b){if(f[b])return f[b];a.debug("params.unknown",b);return{}};this.hide=function(a){(a=this.get(a))&&$(a).closest("label").hide()};this.storage=function(b){var c=a.storage.key("params."+b);return{get:function(){return a.storage.get(c)},isset:function(){return a.storage.isset(c)},key:function(){return c},remove:function(){a.storage.remove(c)},set:function(b){a.storage.set(c,b)}}};this.value=function(a,b){if(a=this.get(a))return b?b(a.value)||b(a.serverValue):a.value||
a.serverValue}};a.resolutions={get:function(b,f){var e=a.resolutions.items();if(1===arguments.length)return e[b];var c=b+"x"+f;if(c in e)return e[c];c=f+"x"+b;if(c in e)return e[c]},keys:function(){var b=a.resolutions.items(),f=Object.keys(b);f.sort(function(a,c){return b[c].width-b[a].width});return f},items:function(){var a=this;a._items||(a._items={},$("#webcam-resolutions > *[data-name][data-standard]").each(function(){var b=$(this),e=b.data("name"),c=e.split("x");a._items[e]={name:e,standard:b.data("standard"),
width:parseInt(c[0]),height:parseInt(c[1])}}));return a._items}};a.setup=function(b,f){if("function"!==typeof document.createElement("canvas").getContext)return a.notice.fail("browserNotSupported");a.notice.loading("detectingDevices");b.nodes&&($.extend(k.nodes,b.nodes),delete b.nodes);f&&$.js.each(f,function(b,c){$.js.each(b,function(b,g){var d=a[c][g];a[c][g]=d?function(){d();b()}:b})});$.js.extend(k,b);a.debug("api.setup",k);a.params.setup();if(k.onsetup&&!0!==k.onsetup())return a.notice.fail("browserNotSupported");
$.include.js("widgets/webcam_api/js/adapter.min.js",function(){return"object"===typeof adapter&&"object"===typeof adapter.browserDetails},function(){function b(c){a.devices.enumerate(function(){var d=a.devices.filter("kind","videoinput");if(d.length)$.js.each(d,function(b,c){$("<option/>",{value:b.deviceId,text:a.label(b,c+1,"camera")}).data({kind:b.kind,label:a.label(b),group:b.groupId}).appendTo(a.nodes().selecter)}),a.timers.add("webcam_detected",k.timeouts.promise,"Timeout",function(){a.nodes().controls.show();
a.notice.done("webcamDetected"+(1<d.length?"Multi":"One"));y();("#autorun"===location.hash||a.params.checked("autorun"))&&w()});else{var g=a.devices.all().length?"noWebcamSomeDevices":"noWebcamNoDevices";g=a.notice.fail(g);if(!0===c){var h=a.notice.text("text_forceQuery");if(h)$("<button/>").html(h).appendTo(g).one("click",function(){a.event("forceQuery","click");$(this).remove();a.devices.query("getUserMedia",[{video:!0}],{done:function(c){if(c&&c.getVideoTracks){c=c.getVideoTracks();for(var d=0;d<
c.length;d++)c[d].stop()}a.event("forceQuery","done");b(!1)},fail:function(b){a.event("forceQuery","fail");a.notice.inject("fail",a.errorify(b)).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}})})}}})}if("function"!==typeof(navigator.mediaDevices||{}).enumerateDevices||"function"!==typeof(window.JSON||{}).stringify)return a.notice.fail("browserNotSupported");b(!0)})};a.status=new u("status",{start:function(){a.action.stopWebcam();a.nodes().controls.hide();a.nodes().actions.hide()},
finish:function(){a.nodes().actions.show()},playWebcam:function(){}});a.storage=new function(){this.get=function(a){return localStorage.getItem(k.name+"."+a)};this.isset=function(b){return null!==a.storage.get(b)};this.key=function(a){return k.name+"."+a};this.remove=function(a){localStorage.removeItem(k.name+"."+a)};this.set=function(a,f){localStorage.setItem(k.name+"."+a,f)}};a.timers={add:function(a,f,e,c){n[a]&&n[a].stop();var b=window["set"+e](function(){"Timeout"===e&&n[a]&&n[a].stop();$.js.run(c)},
f);n[a]={id:b,stop:function(){window["clear"+e](b);delete n[a]}}},get:function(a){return n[a]},clear:function(){$.js.each(n,function(a){a.stop()})},stop:function(b){(b=a.timers.get(b))&&b.stop()}};a.ticker=function(a){var b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b,d){return a.setTimeout(b,1E3/60)},e=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.oCancelAnimationFrame||
a.msCancelAnimationFrame||a.clearTimeout;return function(a){function c(){h&&(g=b(function(){a(++f);c()}))}var g,h,f=0;this.start=function(){h=!0;c()};this.pause=function(){h=!1;e(g)}}}(window);a.webcam=function(b){function f(b){a:{for(var c=0;c<b.length;c++){var g=b[c];if(!1===g.active||!0===g.ended)a.event("badStream",g);else{b=g;break a}}d.on.error("noStream");b=void 0}if(b){a:{c=b;if("function"===typeof c.getVideoTracks)c=c.getVideoTracks();else if("function"===typeof c.getTracks)c=c.getTracks();
else{c=d.on.error("cannotGetTracks");break a}g="noTrack";for(var f=0;f<c.length;f++){var e=c[f];if(/video/i.test(e.kind))if(e.muted)g="trackMuted";else if("ended"===e.readyState)g="trackEnded";else if(!1===e.enabled)g="trackDisabled";else{c=e;break a}a.event("badTrack",e)}d.on.error(g);c=void 0}if(c)return d.stream=b,d.track=c,!0}}function e(a,b){if(b in a)for(a=a[b](),b=0;b<a.length;b++)a[b].stop()}function c(b){d.video=document.getElementById("webcam-stream");d.video.pause();var c=$(d.video).prop("autoplay",
!0).prop("muted",!0).prop("volume",0).prop("src","");$.js.one(c,"loadedmetadata",function(){a.timers.add("play_webcam",k.timeouts.promise,"Timeout",function(){d.video.style.background="none";a:{var c=a.devices.selected();if(!c.data("label")){if(d.track.label){var g=a.label(d.track);if(g){c.text(g).data("label",g);break a}}c.data("label",c.text())}}b()})});d.video.srcObject=d.stream;d.video.play()}var d=this;$.js.extend(d,b);void 0===d.constraints.audio&&(d.constraints.audio=!1);d.constraints.video||
(d.constraints.video={});d.constraints.video.deviceId||(d.constraints.video.deviceId={exact:a.nodes().selecter.val()});this.apply_constraints=function(a,b,e){a=d.track.applyConstraints(a);a.then(function(){c(b)});a["catch"](function(){$.js.run(e)})};this.apply_maxres=function(b){function g(a){if(k>a)return f+=k,k=a,e(),!0}function e(){var a=d.track.applyConstraints({width:{min:f}});a.then(function(){g(100)||g(10)||g(1)||c(b)});a["catch"](function(){f-=k;0<f?e():b()})}if(!a.devices.constraints().width||
"function"!==typeof d.track.applyConstraints)return b();var f=11E3,k=1E3;a.notice.loading("detectingMaxres");e()};this.duration=function(){if(d.video)return d.video.currentTime||d.stream.currentTime||0};this.fullscreen=function(){var a=d.video,b=a.requestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen;if("function"===typeof b)b.apply(a);else return this.fullscreenListener||(this.fullscreenListener=!0,$.js.on(document,"keydown",function(b){27===b.keyCode&&$(a).removeAttr("style")})),
$(a).css({position:"fixed",margin:0,top:0,left:0,bottom:0,right:0})};this.play=function(){a.devices.query("getUserMedia",[d.constraints],{then:function(){$.js.run(d.on.init)},done:function(){f(arguments)&&c(function(){if(!d.playing())return d.on.error("videoPaused");if(32>d.video.videoWidth*d.video.videoHeight)return d.on.error("lowRes");a.event("status","stream");d.on.play(d)})},fail:function(a){d.on.error(a)}})};this.playing=function(){return d.video&&!d.video.paused&&!d.video.ended&&0<d.duration()};
this.resolution=function(a){if(d.video)return d.video.videoWidth+(a||"&times;")+d.video.videoHeight};this.inject_media=function(b){var c=$("<div/>").html(b.node).prependTo(b.wrapper);if(b.name)c.prepend(b.name);else{var d=b.wrapper.find(b.node.tagName).length;b.name=b.type+"-"+d}var e=b.name+"."+b.ext;c.append($("<a/>").prop({text:$.lang.get("media","actions","download"),href:"#"+e}).on("click",function(c){c.preventDefault();a.event("action","download"+b.type);c=document.createElement("a");document.body.appendChild(c);
c.setAttribute("download",e);c.href=b.download_url(e);c.click()}));c.append($("<a/>").prop({text:$.lang.get("media","actions","remove"),href:"#"+e}).on("click",function(d){d.preventDefault();a.event("action","remove"+b.type);c.remove()}))};this.snapshot=function(){var a=document.createElement("canvas");a.width=d.video.videoWidth;a.height=d.video.videoHeight;var b=a.getContext("2d");b.drawImage(d.video,0,0,d.video.videoWidth,d.video.videoHeight);return{canvas:a,ctx:b,inject:function(a){var b=d.snapshot(),
c=new Image;c.src=b.url("image/jpeg");d.inject_media({ext:"jpeg",name:a,node:c,type:"Photo",wrapper:k.nodes.snapshots,download_url:function(a){if("function"===typeof navigator.msSaveOrOpenBlob){for(var b=atob(c.src.split(",")[1]),d=b.length,e=new Uint8Array(d),f=0;f<d;f++)e[f]=b.charCodeAt(f);b=new Blob([e],{type:"image/jpeg"});navigator.msSaveOrOpenBlob(b,a)}return c.src.replace(/image\/[a-z]+/i,"application/octet-stream")}})},url:function(b){return a.toDataURL(b,1)}}};this.stop=function(){d.stream&&
(e(d.stream,"getVideoTracks"),d.constraints.audio&&e(d.stream,"getAudioTracks"));d.video&&(d.video.srcObject=null,d.video.removeAttribute("src"),d.video.removeAttribute("style"));$.js.run(d.on.stop)}};-1!==location.search.indexOf("xdebug=")&&(x(),a.debug("api.init"));a.xdebug=p||{};return a});